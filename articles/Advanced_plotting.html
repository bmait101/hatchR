<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Advanced plotting • hatchR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Advanced plotting">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">hatchR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Introduction to hatchR</h6></li>
    <li><a class="dropdown-item" href="../articles/Introduction.html">Introduction</a></li>
    <li><a class="dropdown-item" href="../articles/Parameterize_models.html">Parameterize hatchR Models</a></li>
    <li><a class="dropdown-item" href="../articles/Predict_phenology_basic.html">Predict fish phenology: basic</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Advanced hatchR</h6></li>
    <li><a class="dropdown-item" href="../articles/Predict_phenology_advanced.html">Predict fish phenology: advanced</a></li>
    <li><a class="dropdown-item" href="../articles/Predict_phenology_nested.html">Predict fish phenology: nested</a></li>
    <li><a class="dropdown-item" href="../articles/Advanced_plotting.html">Advanced plotting</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Model Bibliography</h6></li>
    <li><a class="dropdown-item" href="../articles/Model_bibliography.html">Model bibliography</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/bmait101/hatchR/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Advanced plotting</h1>
                        <h4 data-toc-skip class="author">Morgan Sparks,
Bryan M. Maitland</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/bmait101/hatchR/blob/v0.3.2/vignettes/Advanced_plotting.Rmd" class="external-link"><code>vignettes/Advanced_plotting.Rmd</code></a></small>
      <div class="d-none name"><code>Advanced_plotting.Rmd</code></div>
    </div>

    
    
<div class="section level3">
<h3 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h3>
<p>The goal of this vignette is to provide some examples of how you
might access results from <code><a href="../reference/predict_phenology.html">predict_phenology()</a></code> and how you
might plot your data.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bmait101.github.io/hatchR/">hatchR</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/" class="external-link">purrr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org" class="external-link">lubridate</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://stringr.tidyverse.org" class="external-link">stringr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://wilkelab.org/ggridges/" class="external-link">ggridges</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="a-simple-example">A simple example<a class="anchor" aria-label="anchor" href="#a-simple-example"></a>
</h3>
<p>We’ll return to our first example with Woody Island to show how you
might present data for a single spawning season. First let’s get our
results and output them into a plotting format.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># run map to get a vector of models</span></span>
<span><span class="va">WI_mods</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map_dfr.html" class="external-link">map_df</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"hatch"</span>, <span class="st">"emerge"</span><span class="op">)</span>,</span>
<span>  <span class="va">model_select</span>,</span>
<span>  author <span class="op">=</span> <span class="st">"Beacham and Murray 1990"</span>,</span>
<span>  species <span class="op">=</span> <span class="st">"sockeye"</span>,</span>
<span>  model <span class="op">=</span> <span class="fl">2</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">expression</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># make vector of spawn dates</span></span>
<span><span class="va">WI_spawn_dates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1990-08-14"</span>, <span class="st">"1990-08-18"</span>, <span class="st">"1990-09-3"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># make variables grid</span></span>
<span><span class="va">WI_var_grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/expand_grid.html" class="external-link">expand_grid</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">WI_mods</span><span class="op">$</span><span class="va">expression</span>, spawn.date <span class="op">=</span> <span class="va">WI_spawn_dates</span><span class="op">)</span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span><span class="co"># run pmap for all variable combinations</span></span>
<span><span class="va">WI_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/pmap.html" class="external-link">pmap</a></span><span class="op">(</span><span class="va">WI_var_grid</span>,</span>
<span>  <span class="va">predict_phenology</span>,</span>
<span>  data <span class="op">=</span> <span class="va">woody_island</span>, <span class="co"># additional arguments required by function</span></span>
<span>  dates <span class="op">=</span> <span class="va">date</span>,</span>
<span>  temperature <span class="op">=</span> <span class="va">temp_c</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Now that we have our model results, lets put them in a tibble for plotting</span></span>
<span><span class="va">WI_dev.period</span> <span class="op">&lt;-</span> <span class="va">WI_results</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map_dfr.html" class="external-link">map_df</a></span><span class="op">(</span><span class="st">"dev.period"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    phenology <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"hatch"</span>, <span class="fl">3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"emerge"</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span>, <span class="co"># add a phenology column</span></span>
<span>    days <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">stop</span> <span class="op">-</span> <span class="va">start</span><span class="op">)</span>, <span class="co"># column of the number of days (same as days2done)</span></span>
<span>    index <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="fl">5</span><span class="op">:</span><span class="fl">7</span><span class="op">)</span>  <span class="co"># index for plotting later</span></span>
<span>  <span class="op">)</span> </span></code></pre></div>
<p>Now we’ll make a plot with the temperature and rectangles to show
duration for the hatch and emergence periods.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># min and max for x-axis with 30 day buffer</span></span>
<span><span class="va">x_lims</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">WI_dev.period</span><span class="op">$</span><span class="va">start</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">WI_dev.period</span><span class="op">$</span><span class="va">stop</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/period.html" class="external-link">days</a></span><span class="op">(</span><span class="fl">30</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">y_lims</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">16</span><span class="op">)</span></span>
<span><span class="co"># filter data for plot</span></span>
<span><span class="va">p_data</span> <span class="op">&lt;-</span> <span class="va">woody_island</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">date</span> <span class="op">&gt;=</span> <span class="va">x_lims</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">date</span> <span class="op">&lt;=</span> <span class="va">x_lims</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot1</span> <span class="op">&lt;-</span> <span class="va">p_data</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_rect</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">WI_dev.period</span>, </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>      xmin <span class="op">=</span> <span class="va">start</span>, xmax <span class="op">=</span> <span class="va">stop</span>,</span>
<span>      ymin <span class="op">=</span> <span class="fl">10</span> <span class="op">-</span> <span class="va">index</span>, </span>
<span>      ymax <span class="op">=</span> <span class="fl">10.5</span> <span class="op">-</span> <span class="va">index</span>,</span>
<span>      fill <span class="op">=</span> <span class="va">phenology</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">temp_c</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">0.25</span>, <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">temp_c</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">lims</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x_lims</span>, y <span class="op">=</span> <span class="va">y_lims</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"navyblue"</span>, <span class="st">"dodgerblue"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    legend.position <span class="op">=</span> <span class="st">"inside"</span>,</span>
<span>    legend.position.inside <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.75</span>, <span class="fl">0.75</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="va">plot1</span></span></code></pre></div>
<p><img src="Advanced_plotting_files/figure-html/unnamed-chunk-3-1.png" width="576" style="display: block; margin: auto;"></p>
<p>We can add some labels for days to hatch or emergence and change the
labels on the legend.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot1</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_label</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">WI_dev.period</span>,</span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="va">start</span> <span class="op">+</span> <span class="op">(</span><span class="va">stop</span> <span class="op">-</span> <span class="va">start</span><span class="op">)</span> <span class="op">/</span> <span class="fl">1.25</span>, </span>
<span>      y <span class="op">=</span> <span class="op">(</span><span class="fl">10.25</span> <span class="op">-</span> <span class="va">index</span><span class="op">)</span>, </span>
<span>      label <span class="op">=</span> <span class="va">days</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"navyblue"</span>, <span class="st">"dodgerblue"</span><span class="op">)</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Emerge"</span>, <span class="st">"Hatch"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"Phenology"</span>, y <span class="op">=</span> <span class="st">"Temperature (C)"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Advanced_plotting_files/figure-html/unnamed-chunk-4-1.png" width="576" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="plotting-multiple-years">Plotting multiple years<a class="anchor" aria-label="anchor" href="#plotting-multiple-years"></a>
</h3>
<p>Let’s use the Crooked River data again as it has a number of
continuous years of data without any temperature anomalies.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># spawn dates</span></span>
<span><span class="va">spawn_dates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2011</span><span class="op">:</span><span class="fl">2014</span><span class="op">)</span>, <span class="co"># year vector to map for custom function</span></span>
<span>  <span class="kw">function</span><span class="op">(</span><span class="va">year</span><span class="op">)</span> <span class="op">{</span> <span class="co"># custom paste function</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">year</span>, <span class="st">"-09-01"</span><span class="op">)</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">year</span>, <span class="st">"-09-20"</span><span class="op">)</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">year</span>, <span class="st">"-09-30"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># run map to get a vector of models</span></span>
<span><span class="va">dev_mods</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map_dfr.html" class="external-link">map_df</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"hatch"</span>, <span class="st">"emerge"</span><span class="op">)</span>,</span>
<span>  <span class="va">model_select</span>,</span>
<span>  author <span class="op">=</span> <span class="st">"Austin et al. 2019"</span>,</span>
<span>  species <span class="op">=</span> <span class="st">"bull trout"</span>,</span>
<span>  model <span class="op">=</span> <span class="st">"MM"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">expression</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># variable grid</span></span>
<span><span class="va">var_grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/expand_grid.html" class="external-link">expand_grid</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">dev_mods</span><span class="op">$</span><span class="va">expression</span>, spawn.date <span class="op">=</span> <span class="va">spawn_dates</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">### multiple input mapping</span></span>
<span></span>
<span><span class="va">crooked_predictions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/pmap.html" class="external-link">pmap</a></span><span class="op">(</span><span class="va">var_grid</span>, <span class="co"># combos of variables to iterate over</span></span>
<span>  <span class="va">predict_phenology</span>, <span class="co"># function</span></span>
<span>  data <span class="op">=</span> <span class="va">crooked_river</span>, <span class="co"># additional arguments required by function</span></span>
<span>  dates <span class="op">=</span> <span class="va">date</span>,</span>
<span>  temperature <span class="op">=</span> <span class="va">temp_c</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># make duration dataframe</span></span>
<span><span class="va">CR_dev.period</span> <span class="op">&lt;-</span> <span class="va">crooked_predictions</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map_dfr.html" class="external-link">map_df</a></span><span class="op">(</span><span class="st">"dev.period"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    phenology <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"hatch"</span>, <span class="fl">12</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"emerge"</span>, <span class="fl">12</span><span class="op">)</span><span class="op">)</span>, <span class="co"># add a phenology column</span></span>
<span>    days <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">stop</span> <span class="op">-</span> <span class="va">start</span><span class="op">)</span>, <span class="co"># column of the number of days (same as days2done)</span></span>
<span>    year <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/year.html" class="external-link">year</a></span><span class="op">(</span><span class="va">start</span><span class="op">)</span>, <span class="co"># new column for just year (to facet wrap with)</span></span>
<span>    index <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">5</span><span class="op">:</span><span class="fl">7</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># new index because we're making 4 independent graphs</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html" class="external-link">na.omit</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">&gt;=</span> <span class="fl">2011</span><span class="op">)</span> <span class="co"># remove the 2010 year</span></span></code></pre></div>
<p>We’ll now make similar plot as above but use
<code><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap()</a></code> to break plots apart by year. We do this by
cutting to make a developmental year because phenology spans two
calendar years. As a result, we cut between Aug. 1 of one year and
Aug. 1 of the subsequent year (August 1 instead of Sept. 1 to match the
plot limits we’re setting up) and then make that a developmental year
(the year the adult spawned). Then we can <code><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap()</a></code> to
break the years up in the plot.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">### add a column called year (in this case the developmental year)</span></span>
<span><span class="va">cut_ints</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"2010-08-01"</span>, <span class="st">"2011-08-01"</span>, <span class="st">"2012-08-01"</span>,</span>
<span>    <span class="st">"2013-08-01"</span>, <span class="st">"2014-08-01"</span>,</span>
<span>    <span class="st">"2015-08-01"</span>, <span class="st">"2016-08-01"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  tz <span class="op">=</span> <span class="st">"UTC"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># cut to our cut intervals and label by developmental year</span></span>
<span><span class="va">crooked_river_sy</span> <span class="op">&lt;-</span> <span class="va">crooked_river</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html" class="external-link">cut</a></span><span class="op">(</span><span class="va">date</span>,</span>
<span>    breaks <span class="op">=</span> <span class="va">cut_ints</span>,</span>
<span>    labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2010</span><span class="op">:</span><span class="fl">2015</span><span class="op">)</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>   <span class="co"># cut coerces our labels to factors, this changes them back to numbers</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">&gt;</span> <span class="fl">2010</span> <span class="op">&amp;</span> <span class="va">year</span> <span class="op">&lt;</span> <span class="fl">2015</span><span class="op">)</span> <span class="co"># remove 2010 and 2015</span></span>
<span></span>
<span><span class="co"># make plot (facet_wrap by development year)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_rect</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">CR_dev.period</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>    xmin <span class="op">=</span> <span class="va">start</span>, </span>
<span>    xmax <span class="op">=</span> <span class="va">stop</span>, </span>
<span>    ymin <span class="op">=</span> <span class="fl">10</span> <span class="op">-</span> <span class="va">index</span>, </span>
<span>    ymax <span class="op">=</span> <span class="fl">10.5</span> <span class="op">-</span> <span class="va">index</span>, </span>
<span>    fill <span class="op">=</span> <span class="va">phenology</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">crooked_river_sy</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">temp_c</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">0.25</span>, <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">crooked_river_sy</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">temp_c</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># set limits</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">lims</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">CR_dev.period</span><span class="op">$</span><span class="va">start</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/period.html" class="external-link">days</a></span><span class="op">(</span><span class="fl">30</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">CR_dev.period</span><span class="op">$</span><span class="va">stop</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/period.html" class="external-link">days</a></span><span class="op">(</span><span class="fl">30</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html" class="external-link">scale_x_datetime</a></span><span class="op">(</span>date_labels <span class="op">=</span> <span class="st">"%b"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="co"># facet wrap here subset plots on developmental year</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">year</span>, ncol <span class="op">=</span> <span class="fl">1</span>, scales <span class="op">=</span> <span class="st">"free_x"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"navyblue"</span>, <span class="st">"dodgerblue"</span><span class="op">)</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Emerge"</span>, <span class="st">"Hatch"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="co"># custom colors</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"Phenology"</span>, x <span class="op">=</span> <span class="st">"Date"</span>, y <span class="op">=</span> <span class="st">"Temperature (C)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="Advanced_plotting_files/figure-html/unnamed-chunk-6-1.png" width="576" style="display: block; margin: auto;"></p>
<p>As you can see, this allows us to put our figures on the same X scale
despite flowing into multiple years. You’ll have to figure out the right
way to cut up your data (or find similar alternative options). But this
solves a primary problem of plotting phenology for multiple years, which
is that our results span multiple years and may start and stop in the
same intervals over multiple years (particularly for fall spawning
species).</p>
<div class="callout-note">
<p>Note that we run out of temperature data in 2015, which is why it is
cutoff relative to the others. If you really wanted to fix that you
could be adding on the necessary dates with no temperature data to the
<code>crooked_river_sy</code> tibble.</p>
</div>
</div>
<div class="section level3">
<h3 id="plotting-multiple-individual-spawning-events">Plotting multiple individual spawning events<a class="anchor" aria-label="anchor" href="#plotting-multiple-individual-spawning-events"></a>
</h3>
<p>Another common plotting scenario is that you might have data for when
a number of fish spawn in a single or multiple seasons and want to
represent those results.</p>
<p>We can show a hypothetical scenario with the bull trout example
above. In this scenario, let’s assume we have 300 spawning adult pairs
that spawn in a roughly normal distribution with mean Sept. 15 and a
standard deviation of 5 days (which makes Sept. 1st and 30th 3 sd from
the mean).</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># draw from a normal distribution with above parameters</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">322</span><span class="op">)</span> <span class="co"># allows us to draw same random sample every time for the example</span></span>
<span><span class="va">fish_dist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">300</span>,</span>
<span>  mean <span class="op">=</span> <span class="fl">15</span>,</span>
<span>  sd <span class="op">=</span> <span class="fl">5</span></span>
<span><span class="op">)</span>, <span class="fl">0</span><span class="op">)</span></span>
<span><span class="co"># summary</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fish_dist</span><span class="op">)</span></span>
<span><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span><span class="co">#&gt;    1.00   11.00   14.00   14.38   18.00   28.00</span></span>
<span></span>
<span><span class="co"># change 0s to 1s</span></span>
<span><span class="va">fish_dist</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">fish_dist</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span></span>
<span><span class="co"># look at distribution</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">fish_dist</span><span class="op">)</span></span></code></pre></div>
<p><img src="Advanced_plotting_files/figure-html/unnamed-chunk-7-1.png" width="576" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># make a vector of fish dates and add mo_day to combine with fish_dist</span></span>
<span><span class="va">fish_dates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2014-09-01"</span><span class="op">)</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2014-09-30"</span><span class="op">)</span>, by <span class="op">=</span> <span class="st">"days"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>mo_day <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/day.html" class="external-link">mday</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># loop for repping (could do with map, too)</span></span>
<span><span class="va">fish_dates_norm</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">d</span> <span class="kw">in</span> <span class="va">fish_dates</span><span class="op">$</span><span class="va">mo_day</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">day</span> <span class="op">&lt;-</span> <span class="va">fish_dates</span><span class="op">$</span><span class="va">date</span><span class="op">[</span><span class="va">d</span><span class="op">]</span> <span class="co"># get date</span></span>
<span></span>
<span>  <span class="va">spawners</span> <span class="op">&lt;-</span> <span class="va">fish_dist</span><span class="op">[</span><span class="va">fish_dist</span> <span class="op">==</span> <span class="va">d</span><span class="op">]</span> <span class="co"># vector of spawners in fish_dist</span></span>
<span></span>
<span>  <span class="va">spawners_date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">day</span>, times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">spawners</span><span class="op">)</span><span class="op">)</span> <span class="co"># make vector of date repeated the length of the vector spawners</span></span>
<span></span>
<span>  <span class="va">fish_dates_norm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/append.html" class="external-link">append</a></span><span class="op">(</span><span class="va">fish_dates_norm</span>, <span class="va">spawners_date</span><span class="op">)</span> <span class="co"># append to out file</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">fish_dates_norm</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2014-09-01" "2014-09-02" "2014-09-03" "2014-09-03" "2014-09-03"</span></span>
<span><span class="co">#&gt; [6] "2014-09-04"</span></span>
<span></span>
<span><span class="co"># now let's make the same vector for 2013 so we can compare two years</span></span>
<span><span class="va">fish_dates_13</span> <span class="op">&lt;-</span> <span class="va">fish_dates_norm</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html" class="external-link">str_replace_all</a></span><span class="op">(</span><span class="st">"2014"</span>, <span class="st">"2013"</span><span class="op">)</span> <span class="co"># replace all the 2014s with 2013 using string replace</span></span>
<span></span>
<span><span class="co"># add the two together in a vector and sort</span></span>
<span><span class="va">fish_dates_all</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/append.html" class="external-link">append</a></span><span class="op">(</span><span class="va">fish_dates_norm</span>, <span class="va">fish_dates_13</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># looks good!</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">fish_dates_all</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2013-09-01" "2013-09-02" "2013-09-03" "2013-09-03" "2013-09-03"</span></span>
<span><span class="co">#&gt; [6] "2013-09-04"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">fish_dates_all</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2014-09-25" "2014-09-26" "2014-09-26" "2014-09-26" "2014-09-28"</span></span>
<span><span class="co">#&gt; [6] "2014-09-28"</span></span>
<span></span>
<span><span class="co"># remember these all need to be in a character string for predict_phenology()!</span></span>
<span><span class="va">fish_dates_str</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="va">fish_dates_all</span>, <span class="st">"%Y-%m-%d"</span><span class="op">)</span></span></code></pre></div>
<p>Now we can map hatch and emergence timing across the vector of dates
we have created for the two years. Notice we have chosen two fairly
thermally different years with quite different developmental phenology
estimates (see plot from <a href="#plotting-multiple-years">Plotting
multiple years</a>).</p>
<p>Also, we’re going to take a short cut with our mapping so we don’t
store all the results of each date (1200 total, 600 for each
developmental period estimated) in our memory. So instead, we will pipe
<code>|&gt;</code> our <code><a href="https://purrr.tidyverse.org/reference/pmap.html" class="external-link">pmap()</a></code> into a
<code>map_dbl("dev.period")</code> command so we only are left with our
phenology estimates and not all the other data we would have otherwise
outputted.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># make variable grid for pmap (we use dev_mods from previous example)</span></span>
<span><span class="va">spawn_grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/expand_grid.html" class="external-link">expand_grid</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">dev_mods</span><span class="op">$</span><span class="va">expression</span>, spawn.date <span class="op">=</span> <span class="va">fish_dates_str</span><span class="op">)</span></span>
<span></span>
<span><span class="va">bull_trout_dist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/pmap.html" class="external-link">pmap</a></span><span class="op">(</span><span class="va">spawn_grid</span>,</span>
<span>  <span class="va">predict_phenology</span>,</span>
<span>  data <span class="op">=</span> <span class="va">crooked_river</span>, <span class="co"># additional arguments required by function</span></span>
<span>  dates <span class="op">=</span> <span class="va">date</span>,</span>
<span>  temperature <span class="op">=</span> <span class="va">temp_c</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># pipe!</span></span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map_dfr.html" class="external-link">map_df</a></span><span class="op">(</span><span class="st">"dev.period"</span><span class="op">)</span> <span class="co"># just output dev.period</span></span>
<span></span>
<span><span class="co">### now let's add the key columns for plotting</span></span>
<span></span>
<span><span class="co"># first you can see the output and the spawn grid have the same number of rows so</span></span>
<span><span class="co"># we can borrow the format from the spawn grid</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">bull_trout_dist</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 2</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">spawn_grid</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1200    2</span></span>
<span></span>
<span><span class="co"># moreover from the grid, you can see that it predicts hatch for all the dates first</span></span>
<span><span class="co"># and then predicts emergence</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">spawn_grid</span><span class="op">$</span><span class="va">model</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "1/exp(5.086 - (x * 0.131))" "1/exp(5.086 - (x * 0.131))"</span></span>
<span><span class="co">#&gt; [3] "1/exp(5.086 - (x * 0.131))" "1/exp(5.086 - (x * 0.131))"</span></span>
<span><span class="co">#&gt; [5] "1/exp(5.086 - (x * 0.131))" "1/exp(5.086 - (x * 0.131))"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">spawn_grid</span><span class="op">$</span><span class="va">model</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "1/exp(5.590 - (x  * 0.126))" "1/exp(5.590 - (x  * 0.126))"</span></span>
<span><span class="co">#&gt; [3] "1/exp(5.590 - (x  * 0.126))" "1/exp(5.590 - (x  * 0.126))"</span></span>
<span><span class="co">#&gt; [5] "1/exp(5.590 - (x  * 0.126))" "1/exp(5.590 - (x  * 0.126))"</span></span>
<span></span>
<span><span class="co"># now we can borrow all that information to make the exact data object we want</span></span>
<span><span class="va">bull_trout_dist_phenology</span> <span class="op">&lt;-</span> <span class="va">bull_trout_dist</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    Date <span class="op">=</span> <span class="va">stop</span>, <span class="co"># rename stop to Date</span></span>
<span>    Phenology <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"Hatch"</span>, <span class="fl">600</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"Emerge"</span>, <span class="fl">600</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># make phenology column</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">Date</span><span class="op">:</span><span class="va">Phenology</span><span class="op">)</span> <span class="co"># select date and phenology columns to put in object</span></span>
<span></span>
<span><span class="co"># make a similar object with spawning data (notice we name the columns the exact same)</span></span>
<span><span class="va">bull_trout_spawn_phenology</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>Date <span class="op">=</span> <span class="va">fish_dates_all</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Phenology <span class="op">=</span> <span class="st">"Spawn"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># combine spawn and hatch/emerge objects for a final plotting object</span></span>
<span><span class="va">bull_trout_all_phenology</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span></span>
<span>  <span class="va">bull_trout_spawn_phenology</span>,</span>
<span>  <span class="va">bull_trout_dist_phenology</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/year.html" class="external-link">year</a></span><span class="op">(</span><span class="va">Date</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html" class="external-link">na.omit</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">bull_trout_all_phenology</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 3</span></span></span>
<span><span class="co">#&gt;   Date                Phenology     y</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 2013-09-01 <span style="color: #949494;">00:00:00</span> Spawn      <span style="text-decoration: underline;">2</span>013</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 2013-09-02 <span style="color: #949494;">00:00:00</span> Spawn      <span style="text-decoration: underline;">2</span>013</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 2013-09-03 <span style="color: #949494;">00:00:00</span> Spawn      <span style="text-decoration: underline;">2</span>013</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 2013-09-03 <span style="color: #949494;">00:00:00</span> Spawn      <span style="text-decoration: underline;">2</span>013</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 2013-09-03 <span style="color: #949494;">00:00:00</span> Spawn      <span style="text-decoration: underline;">2</span>013</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1 more row</span></span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">bull_trout_all_phenology</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 3</span></span></span>
<span><span class="co">#&gt;   Date                Phenology     y</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 2015-04-11 <span style="color: #949494;">00:00:00</span> Emerge     <span style="text-decoration: underline;">2</span>015</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 2015-04-13 <span style="color: #949494;">00:00:00</span> Emerge     <span style="text-decoration: underline;">2</span>015</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 2015-04-13 <span style="color: #949494;">00:00:00</span> Emerge     <span style="text-decoration: underline;">2</span>015</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 2015-04-13 <span style="color: #949494;">00:00:00</span> Emerge     <span style="text-decoration: underline;">2</span>015</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 2015-04-17 <span style="color: #949494;">00:00:00</span> Emerge     <span style="text-decoration: underline;">2</span>015</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1 more row</span></span></span></code></pre></div>
<p>Before we plot, let’s briefly walk through what we did there. First
we made our predictions but then only output the start and stop data
with the <code>map_df("dev.period")</code> command. Next we added a
<code>Phenology</code> column with the appropriate phenology type
determined by the structure of our <code>spawn_grid</code> object. Then
we made a similar object for spawning which we combined with the mapping
ouput all into <code>bull_trout_all_phenology</code>. The reason for
this is we will plot the distributions of spawning, hatching, and
emergence across years.</p>
<p>You can see we also need to cut like we did before to add a
developmental year and we use <code><a href="https://ggplot2.tidyverse.org/reference/geom_blank.html" class="external-link">geom_blank()</a></code> and custom
limits to set everything on the same scale.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># before we plot, because we are again plotting across years we need to cut up our data</span></span>
<span><span class="co"># still need 2012 and 2015 because phenology will leak over</span></span>
<span><span class="va">cut_ints_1314</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"2012-08-01"</span>, <span class="st">"2013-08-01"</span>,</span>
<span>  <span class="st">"2014-08-01"</span>, <span class="st">"2015-08-01"</span></span>
<span><span class="op">)</span>, tz <span class="op">=</span> <span class="st">"UTC"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># cut according to our cut intervals and label by developmental year</span></span>
<span><span class="va">bull_trout_phenology_cut</span> <span class="op">&lt;-</span> <span class="va">bull_trout_all_phenology</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html" class="external-link">cut</a></span><span class="op">(</span><span class="va">Date</span>,</span>
<span>    breaks <span class="op">=</span> <span class="va">cut_ints_1314</span>,</span>
<span>    labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2012</span><span class="op">:</span><span class="fl">2014</span><span class="op">)</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html" class="external-link">na.omit</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="co"># look to see max development days to make custom lims</span></span>
<span><span class="va">bull_trout_dist</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>phen_days <span class="op">=</span> <span class="va">stop</span> <span class="op">-</span> <span class="va">start</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice_max</a></span><span class="op">(</span><span class="va">phen_days</span><span class="op">)</span> <span class="co"># output max value</span></span>
<span><span class="co">#&gt;        start       stop phen_days</span></span>
<span><span class="co">#&gt; 1 2013-09-28 2014-04-30  214 days</span></span>
<span><span class="co">#&gt; 2 2013-09-28 2014-04-30  214 days</span></span>
<span></span>
<span><span class="co"># make custom lims using 30 days before first spawn and 244 days max (214 + 30) from above</span></span>
<span><span class="co"># makes a 30 day buffer</span></span>
<span><span class="va">cust_lims</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>min <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2013-08-01"</span>, <span class="st">"2014-08-01"</span><span class="op">)</span>, tz <span class="op">=</span> <span class="st">"UTC"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>max <span class="op">=</span> <span class="va">min</span> <span class="op">+</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/period.html" class="external-link">days</a></span><span class="op">(</span><span class="fl">244</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"type"</span>, values_to <span class="op">=</span> <span class="st">"Date"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2013</span>, <span class="fl">2013</span>, <span class="fl">2014</span>, <span class="fl">2014</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># make plot</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_blank.html" class="external-link">geom_blank</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">cust_lims</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Date</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="co"># we use geom_blank to keep everything on the same limits from our custom lims object</span></span>
<span>  <span class="fu"><a href="https://wilkelab.org/ggridges/reference/geom_density_ridges.html" class="external-link">geom_density_ridges</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">bull_trout_phenology_cut</span>,</span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Date</span>, y <span class="op">=</span> <span class="va">Phenology</span>, color <span class="op">=</span> <span class="va">Phenology</span>, fill <span class="op">=</span> <span class="va">Phenology</span><span class="op">)</span>,</span>
<span>    jittered_points <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    position <span class="op">=</span> <span class="fu"><a href="https://wilkelab.org/ggridges/reference/position_points_jitter.html" class="external-link">position_points_jitter</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.05</span>, height <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>    point_shape <span class="op">=</span> <span class="st">"|"</span>, point_size <span class="op">=</span> <span class="fl">2</span>, point_alpha <span class="op">=</span> <span class="fl">1</span>, alpha <span class="op">=</span> <span class="fl">0.7</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">lims</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">cust_lims</span><span class="op">$</span><span class="va">Date</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/period.html" class="external-link">days</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">cust_lims</span><span class="op">$</span><span class="va">Date</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/period.html" class="external-link">days</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html" class="external-link">scale_x_datetime</a></span><span class="op">(</span>date_labels <span class="op">=</span> <span class="st">"%b"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_fill_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Dark2"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_color_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Dark2"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">year</span>, ncol <span class="op">=</span> <span class="fl">1</span>, scales <span class="op">=</span> <span class="st">"free_x"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Advanced_plotting_files/figure-html/unnamed-chunk-9-1.png" width="576" style="display: block; margin: auto;"></p>
<p>As you can see, even small differences in thermal regime can make for
big differences in developmental phenology.</p>
<p>We could even combine this plot with the plot we made previously to
show regime and duration alongside the distributions. For combining
plots we highly recommend the <a href="https://patchwork.data-imaginist.com/" class="external-link">patchwork package</a>.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># same plot as before but we'll filter the years to 2013 and 2014</span></span>
<span></span>
<span><span class="va">CR_dev.period_1314</span> <span class="op">&lt;-</span> <span class="va">CR_dev.period</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2013</span>, <span class="fl">2014</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">crooked_river_sy_1314</span> <span class="op">&lt;-</span> <span class="va">crooked_river_sy</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2013</span>, <span class="fl">2014</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># name plot as object p1</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_rect</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">CR_dev.period_1314</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>    xmin <span class="op">=</span> <span class="va">start</span>, xmax <span class="op">=</span> <span class="va">stop</span>, <span class="co"># draw bars</span></span>
<span>    ymin <span class="op">=</span> <span class="fl">10</span> <span class="op">-</span> <span class="va">index</span>, ymax <span class="op">=</span> <span class="fl">10.5</span> <span class="op">-</span> <span class="va">index</span>, <span class="co"># use index to vertically place rects</span></span>
<span>    fill <span class="op">=</span> <span class="va">phenology</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">crooked_river_sy_1314</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">temp_c</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">0.25</span>, <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">crooked_river_sy_1314</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">temp_c</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">lims</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">CR_dev.period</span><span class="op">$</span><span class="va">start</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/period.html" class="external-link">days</a></span><span class="op">(</span><span class="fl">30</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">CR_dev.period</span><span class="op">$</span><span class="va">stop</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/period.html" class="external-link">days</a></span><span class="op">(</span><span class="fl">30</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="co"># set limits</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html" class="external-link">scale_x_datetime</a></span><span class="op">(</span>date_labels <span class="op">=</span> <span class="st">"%b"</span><span class="op">)</span> <span class="op">+</span> <span class="co"># change X label to month</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">year</span>, ncol <span class="op">=</span> <span class="fl">1</span>, scales <span class="op">=</span> <span class="st">"free_x"</span><span class="op">)</span> <span class="op">+</span> <span class="co"># facet wrap here subset plots on developmental year</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"navyblue"</span>, <span class="st">"dodgerblue"</span><span class="op">)</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Emerge"</span>, <span class="st">"Hatch"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="co"># custom colors</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"Phenology"</span>, x <span class="op">=</span> <span class="st">"Date"</span>, y <span class="op">=</span> <span class="st">"Temperature (C)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># name distribution plot as object p2</span></span>
<span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_blank.html" class="external-link">geom_blank</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">cust_lims</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Date</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="co"># we use geom_blank to keep everything on the same limits from our custom lims object</span></span>
<span>  <span class="fu"><a href="https://wilkelab.org/ggridges/reference/geom_density_ridges.html" class="external-link">geom_density_ridges</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">bull_trout_phenology_cut</span>,</span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Date</span>, y <span class="op">=</span> <span class="va">Phenology</span>, color <span class="op">=</span> <span class="va">Phenology</span>, fill <span class="op">=</span> <span class="va">Phenology</span><span class="op">)</span>,</span>
<span>    jittered_points <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    position <span class="op">=</span> <span class="fu"><a href="https://wilkelab.org/ggridges/reference/position_points_jitter.html" class="external-link">position_points_jitter</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.05</span>, height <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>    point_shape <span class="op">=</span> <span class="st">"|"</span>, point_size <span class="op">=</span> <span class="fl">2</span>, point_alpha <span class="op">=</span> <span class="fl">1</span>, alpha <span class="op">=</span> <span class="fl">0.7</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">lims</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">cust_lims</span><span class="op">$</span><span class="va">Date</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/period.html" class="external-link">days</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">cust_lims</span><span class="op">$</span><span class="va">Date</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/period.html" class="external-link">days</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html" class="external-link">scale_x_datetime</a></span><span class="op">(</span>date_labels <span class="op">=</span> <span class="st">"%b"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_fill_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Dark2"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_color_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Dark2"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">year</span>, ncol <span class="op">=</span> <span class="fl">1</span>, scales <span class="op">=</span> <span class="st">"free_x"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">### patchwork plot</span></span>
<span></span>
<span><span class="co"># plot the two plots side by side using + operator, you can stack with / operator</span></span>
<span><span class="va">p1</span> <span class="op">+</span> <span class="va">p2</span></span></code></pre></div>
<p><img src="Advanced_plotting_files/figure-html/unnamed-chunk-10-1.png" width="576" style="display: block; margin: auto;"></p>
<p>There are many more ways you can plot your data but we these are
meant to serve as templates and/or guides around common issues related
to plotting phenology data.</p>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Bryan M. Maitland, Morgan M. Sparks.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
